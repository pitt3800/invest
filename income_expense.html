<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëª¨ë“ˆ 2: ìˆ˜ì…/ì§€ì¶œ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        /*
        ===========================================
        ëª¨ë“ˆ 2: ìˆ˜ì…/ì§€ì¶œ ê´€ë¦¬ ì‹œìŠ¤í…œ ìŠ¤íƒ€ì¼
        ===========================================
        */
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .monthly-summary {
            font-size: 1.2em;
            margin-top: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            text-align: center;
        }
        
        .summary-item {
            display: flex;
            flex-direction: column;
        }
        
        .summary-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .summary-amount {
            font-size: 1.3em;
            font-weight: bold;
        }
        
        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        
        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.3s ease;
        }
        
        .nav-tab.active {
            background: white;
            color: #28a745;
            border-bottom: 3px solid #28a745;
        }
        
        .nav-tab:hover {
            background: #e9ecef;
            color: #495057;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .input-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .section-title {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
        }
        
        .section-title .icon {
            margin-right: 10px;
            font-size: 1.2em;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 2fr 1.5fr 1fr 1fr;
            gap: 15px;
            align-items: end;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 10px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: 500;
            margin-bottom: 5px;
            color: #555;
        }
        
        .form-group input,
        .form-group select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .charts-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .chart-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            color: #333;
        }
        
        .chart-canvas {
            position: relative;
            height: 300px;
        }
        
        .item-list {
            margin-top: 20px;
        }
        
        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: white;
            border: 1px solid #eee;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .list-item:hover {
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .item-info {
            display: flex;
            flex-direction: column;
        }
        
        .item-name {
            font-weight: bold;
            font-size: 1.1em;
            color: #333;
        }
        
        .item-category {
            font-size: 0.9em;
            color: #666;
        }
        
        .item-amount {
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .income-amount {
            color: #28a745;
        }
        
        .expense-amount {
            color: #dc3545;
        }
        
        .item-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 0.9em;
        }
        
        .category-summary {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }
        
        .category-header {
            background: #28a745;
            color: white;
            padding: 10px 15px;
            margin: 15px 0 10px 0;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .month-navigation {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .month-nav-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
        }
        
        .month-nav-btn:hover {
            background: #218838;
        }
        
        .current-month {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }

        /* ìë™ ì €ì¥ í‘œì‹œ */
        .auto-save-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 0.9em;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .auto-save-indicator.show {
            opacity: 1;
        }
        
        @media (max-width: 768px) {
            .charts-row {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .monthly-summary {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ìë™ ì €ì¥ í‘œì‹œê¸° -->
    <div class="auto-save-indicator" id="autoSaveIndicator">
        ğŸ’¾ ìë™ ì €ì¥ë¨
    </div>

    <div class="container">
        <!-- í—¤ë” êµ¬ì—­ -->
        <div class="header">
            <h1>ğŸ’° ìˆ˜ì…/ì§€ì¶œ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
            <p>ì‘ê¸‰ì˜í•™ê³¼ ì „ë¬¸ì˜ë¥¼ ìœ„í•œ íˆ¬ìì—¬ë ¥ ê´€ë¦¬</p>
            <div class="monthly-summary">
                <div class="summary-item">
                    <div class="summary-label">ì›” ì´ìˆ˜ì…</div>
                    <div class="summary-amount" id="totalIncome">0ì›</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">ì›” ì´ì§€ì¶œ</div>
                    <div class="summary-amount" id="totalExpense">0ì›</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">íˆ¬ìì—¬ë ¥</div>
                    <div class="summary-amount" id="investmentCapacity">0ì›</div>
                </div>
            </div>
        </div>
        
        <!-- ì›” ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="month-navigation">
            <button class="month-nav-btn" onclick="ì´ì „ì›”()">â—€ ì´ì „ì›”</button>
            <div class="current-month" id="currentMonth">2025ë…„ 6ì›”</div>
            <button class="month-nav-btn" onclick="ë‹¤ìŒì›”()">ë‹¤ìŒì›” â–¶</button>
        </div>
        
        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="íƒ­ë³€ê²½('income')">ğŸ’¼ ìˆ˜ì… ê´€ë¦¬</button>
            <button class="nav-tab" onclick="íƒ­ë³€ê²½('expense')">ğŸ’³ ì§€ì¶œ ê´€ë¦¬</button>
            <button class="nav-tab" onclick="íƒ­ë³€ê²½('analysis')">ğŸ“Š ë¶„ì„</button>
            <button class="nav-tab" onclick="íƒ­ë³€ê²½('data')">ğŸ’¾ ë°ì´í„°ê´€ë¦¬</button>
        </div>
        
        <!-- ìˆ˜ì… ê´€ë¦¬ íƒ­ -->
        <div id="income" class="tab-content active">
            <!-- ìˆ˜ì… ì¶”ê°€ -->
            <div class="input-section">
                <div class="section-title">
                    <span class="icon">ğŸ’¼</span>
                    ì›” ìˆ˜ì… ì¶”ê°€
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>ìˆ˜ì… í•­ëª©</label>
                        <select id="incomeItem">
                            <option value="">ìˆ˜ì…ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ë³‘ì›ê¸‰ì—¬">ë³‘ì›ê¸‰ì—¬</option>
                            <option value="ë³´ê±´ì†Œ">ë³´ê±´ì†Œ</option>
                            <option value="ê°•ì›ìƒí™©ì‹¤">ê°•ì›ìƒí™©ì‹¤</option>
                            <option value="í‰ì°½ì†Œë°©ì„œ">í‰ì°½ì†Œë°©ì„œ</option>
                            <option value="ì›”ì„¸">ì›”ì„¸</option>
                            <option value="íˆ¬ììˆ˜ìµ">íˆ¬ììˆ˜ìµ</option>
                            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ìƒì„¸ ë‚´ìš© (ì„ íƒ)</label>
                        <input type="text" id="incomeDetail" placeholder="ì˜ˆ: ë‹¹ì§ë¹„, ì™¸ë˜ìˆ˜ë‹¹ ë“±">
                    </div>
                    <div class="form-group">
                        <label>ê¸ˆì•¡ (ë§Œì›)</label>
                        <input type="number" id="incomeAmount" placeholder="0" step="1">
                    </div>
                    <div class="form-group">
                        <button class="btn btn-success" onclick="ìˆ˜ì…ì¶”ê°€()">ì¶”ê°€</button>
                    </div>
                </div>
            </div>
            
            <!-- ìˆ˜ì… ëª©ë¡ -->
            <div class="category-summary">
                <div class="section-title">
                    <span class="icon">ğŸ“‹</span>
                    í˜„ì¬ ì›” ìˆ˜ì… ë‚´ì—­
                </div>
                <div id="incomeList" class="item-list">
                    <!-- ìˆ˜ì… ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
        
        <!-- ì§€ì¶œ ê´€ë¦¬ íƒ­ -->
        <div id="expense" class="tab-content">
            <!-- ì§€ì¶œ ì¶”ê°€ -->
            <div class="input-section">
                <div class="section-title">
                    <span class="icon">ğŸ’³</span>
                    ì›” ì§€ì¶œ ì¶”ê°€
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>ì§€ì¶œ í•­ëª©</label>
                        <select id="expenseItem">
                            <option value="">ì§€ì¶œì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì‚¼ì„±ì¹´ë“œ">ì‚¼ì„±ì¹´ë“œ</option>
                            <option value="í˜„ëŒ€ì¹´ë“œ">í˜„ëŒ€ì¹´ë“œ</option>
                            <option value="í•˜ë‚˜ì¹´ë“œ">í•˜ë‚˜ì¹´ë“œ</option>
                            <option value="ìƒí™œë¹„">ìƒí™œë¹„</option>
                            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ìƒì„¸ ë‚´ìš© (ì„ íƒ)</label>
                        <input type="text" id="expenseDetail" placeholder="ì˜ˆ: ë³‘ì›ë¹„, ì‹ë¹„, ì£¼ê±°ë¹„ ë“±">
                    </div>
                    <div class="form-group">
                        <label>ê¸ˆì•¡ (ë§Œì›)</label>
                        <input type="number" id="expenseAmount" placeholder="0" step="1">
                    </div>
                    <div class="form-group">
                        <button class="btn btn-success" onclick="ì§€ì¶œì¶”ê°€()">ì¶”ê°€</button>
                    </div>
                </div>
            </div>
            
            <!-- ì§€ì¶œ ëª©ë¡ -->
            <div class="category-summary">
                <div class="section-title">
                    <span class="icon">ğŸ“‹</span>
                    í˜„ì¬ ì›” ì§€ì¶œ ë‚´ì—­
                </div>
                <div id="expenseList" class="item-list">
                    <!-- ì§€ì¶œ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
        
        <!-- ë¶„ì„ íƒ­ -->
        <div id="analysis" class="tab-content">
            <!-- ì°¨íŠ¸ êµ¬ì—­ -->
            <div class="charts-row">
                <!-- ìˆ˜ì… ë¶„ì„ ì°¨íŠ¸ -->
                <div class="chart-container">
                    <div class="chart-title">ì›” ìˆ˜ì… êµ¬ì„±</div>
                    <div class="chart-canvas">
                        <canvas id="incomeChart"></canvas>
                    </div>
                </div>
                
                <!-- ì§€ì¶œ ë¶„ì„ ì°¨íŠ¸ -->
                <div class="chart-container">
                    <div class="chart-title">ì›” ì§€ì¶œ êµ¬ì„±</div>
                    <div class="chart-canvas">
                        <canvas id="expenseChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- ì›”ë³„ ì¶”ì´ ì°¨íŠ¸ -->
            <div class="chart-container">
                <div class="chart-title">ìˆ˜ì…/ì§€ì¶œ/íˆ¬ìì—¬ë ¥ ì›”ë³„ ì¶”ì´</div>
                <div class="chart-canvas">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- ë°ì´í„° ê´€ë¦¬ íƒ­ -->
        <div id="data" class="tab-content">
            <!-- ë°ì´í„° ê´€ë¦¬ ì„¹ì…˜ -->
            <div class="input-section">
                <div class="section-title">
                    <span class="icon">ğŸ’¾</span>
                    ë°ì´í„° ì €ì¥ ë° ë¶ˆëŸ¬ì˜¤ê¸°
                </div>
                <p style="color: #666; margin-bottom: 20px;">
                    ğŸ’¡ ìˆ˜ì…/ì§€ì¶œ ë°ì´í„°ë¥¼ íŒŒì¼ë¡œ ì €ì¥í•˜ê±°ë‚˜ ì´ì „ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <button class="btn btn-success" onclick="ë°ì´í„°ì €ì¥()" style="padding: 15px; font-size: 1.1em;">
                        ğŸ’¾ ë°ì´í„° ì €ì¥<br>
                        <small style="font-size: 0.8em;">JSON íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ</small>
                    </button>
                    <button class="btn btn-primary" onclick="ë°ì´í„°ë¶ˆëŸ¬ì˜¤ê¸°()" style="padding: 15px; font-size: 1.1em;">
                        ğŸ“‚ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°<br>
                        <small style="font-size: 0.8em;">ì´ì „ ì €ì¥ íŒŒì¼ ì—…ë¡œë“œ</small>
                    </button>
                    <button class="btn btn-secondary" onclick="ìƒ˜í”Œë°ì´í„°ë¡œë“œ()" style="padding: 15px; font-size: 1.1em;">
                        ğŸ”„ ìƒ˜í”Œ ë°ì´í„°<br>
                        <small style="font-size: 0.8em;">í…ŒìŠ¤íŠ¸ìš© ë°ì´í„° ë¡œë“œ</small>
                    </button>
                    <button class="btn btn-danger" onclick="ë°ì´í„°ì´ˆê¸°í™”()" style="padding: 15px; font-size: 1.1em;">
                        ğŸ—‘ï¸ ë°ì´í„° ì´ˆê¸°í™”<br>
                        <small style="font-size: 0.8em;">ëª¨ë“  ë°ì´í„° ì‚­ì œ</small>
                    </button>
                </div>
                <input type="file" id="fileInput" accept=".json" style="display: none;" onchange="íŒŒì¼ë¶ˆëŸ¬ì˜¤ê¸°(event)">
                
                <!-- ìë™ ì €ì¥ ìƒíƒœ í‘œì‹œ -->
                <div style="margin-top: 20px; padding: 15px; background: #e3f2fd; border-radius: 8px;">
                    <h4 style="color: #1976d2; margin-bottom: 10px;">ğŸ’¾ ìë™ ì €ì¥ ìƒíƒœ</h4>
                    <div id="autoSaveStatus">
                        ìë™ ì €ì¥ í™œì„±í™”: ë°ì´í„° ë³€ê²½ ì‹œ ìë™ìœ¼ë¡œ ë¸Œë¼ìš°ì €ì— ì €ì¥ë©ë‹ˆë‹¤.
                    </div>
                </div>
            </div>
            
            <!-- í˜„ì¬ ë°ì´í„° í˜„í™© -->
            <div class="input-section">
                <div class="section-title">
                    <span class="icon">ğŸ“Š</span>
                    í˜„ì¬ ë°ì´í„° í˜„í™©
                </div>
                <div id="dataStatus" style="background: white; padding: 20px; border-radius: 10px;">
                    <!-- ë°ì´í„° í˜„í™©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
            
            <!-- ì›”ë³„ ë°ì´í„° ìš”ì•½ -->
            <div class="input-section">
                <div class="section-title">
                    <span class="icon">ğŸ“…</span>
                    ì›”ë³„ ë°ì´í„° ìš”ì•½
                </div>
                <div id="monthlyDataSummary" style="background: white; padding: 20px; border-radius: 10px;">
                    <!-- ì›”ë³„ ìš”ì•½ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        /*
        ===========================================
        ì „ì—­ ë³€ìˆ˜ ë° ë°ì´í„° êµ¬ì¡°
        ===========================================
        */
        
        // â­ ìˆ˜ì •: localStorage í‚¤ ì´ë¦„ì„ index.htmlê³¼ ì •í™•íˆ ì¼ì¹˜ì‹œí‚´
        const STORAGE_KEYS = {
            ì›”ë³„ë°ì´í„°: 'module2_monthly_data',
            ì‹œìŠ¤í…œì„¤ì •: 'module2_settings'
        };
        
        // í˜„ì¬ ì„ íƒëœ ë…„ì›”
        let í˜„ì¬ë…„ì›” = new Date();
        
        // ì›”ë³„ ìˆ˜ì…/ì§€ì¶œ ë°ì´í„°
        let ì›”ë³„ë°ì´í„° = {};
        
        // ì°¨íŠ¸ ê°ì²´ë“¤
        let ìˆ˜ì…ì°¨íŠ¸ = null;
        let ì§€ì¶œì°¨íŠ¸ = null;
        let ì¶”ì´ì°¨íŠ¸ = null;
        
        // ìƒ‰ìƒ ì„¤ì •
        const ìˆ˜ì…ìƒ‰ìƒ = ['#28a745', '#20c997', '#17a2b8', '#6f42c1', '#e83e8c', '#fd7e14', '#ffc107', '#6c757d'];
        const ì§€ì¶œìƒ‰ìƒ = ['#dc3545', '#fd7e14', '#ffc107', '#20c997', '#6f42c1', '#e83e8c', '#17a2b8', '#6c757d'];
        
        // â­ ë””ë²„ê¹… ëª¨ë“œ (ì½˜ì†” ë¡œê·¸ ì¶œë ¥ ì—¬ë¶€)
        let ë””ë²„ê·¸ëª¨ë“œ = true;
        
        // ë””ë²„ê¹…ìš© ë¡œê·¸ í•¨ìˆ˜
        function ë¡œê·¸(ë©”ì‹œì§€, ë°ì´í„° = null) {
            if (ë””ë²„ê·¸ëª¨ë“œ) {
                const ì‹œê°„ = new Date().toLocaleTimeString();
                console.log(`[${ì‹œê°„}] ğŸ’° ëª¨ë“ˆ2: ${ë©”ì‹œì§€}`);
                if (ë°ì´í„°) {
                    console.log('ğŸ“Š ë°ì´í„°:', ë°ì´í„°);
                }
            }
        }
        
        /*
        ===========================================
        â­ ê°•í™”ëœ ìë™ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜ë“¤
        ===========================================
        */
        
        // â­ ê°œì„ ëœ ìë™ ì €ì¥ í•¨ìˆ˜
        function ìë™ì €ì¥() {
            try {
                ë¡œê·¸('ğŸ’¾ ìë™ ì €ì¥ ì‹œì‘');
                
                // í˜„ì¬ ì›” ë°ì´í„° ê³„ì‚°
                const í˜„ì¬ì›”ìˆ˜ì… = ì›”ì´ìˆ˜ì…ê³„ì‚°();
                const í˜„ì¬ì›”ì§€ì¶œ = ì›”ì´ì§€ì¶œê³„ì‚°();
                const í˜„ì¬ì›”íˆ¬ìì—¬ë ¥ = íˆ¬ìì—¬ë ¥ê³„ì‚°();
                const í˜„ì¬ì›”í‚¤ê°’ = í˜„ì¬ì›”í‚¤();
                
                // â­ ëŒ€ì‹œë³´ë“œ í˜¸í™˜ì„±ì„ ìœ„í•œ ë°ì´í„° êµ¬ì¡° ê°œì„ 
                const ì €ì¥ë°ì´í„° = {
                    ì›”ë³„ë°ì´í„°: ì›”ë³„ë°ì´í„°,
                    í˜„ì¬ë…„ì›”: {
                        year: í˜„ì¬ë…„ì›”.getFullYear(),
                        month: í˜„ì¬ë…„ì›”.getMonth()
                    },
                    // â­ ëŒ€ì‹œë³´ë“œì—ì„œ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìš”ì•½ ë°ì´í„° ì¶”ê°€
                    ì›”ìˆ˜ì…: í˜„ì¬ì›”ìˆ˜ì…,
                    ì›”ì§€ì¶œ: í˜„ì¬ì›”ì§€ì¶œ,
                    íˆ¬ìì—¬ë ¥: í˜„ì¬ì›”íˆ¬ìì—¬ë ¥,
                    ìˆ˜ì…ê±´ìˆ˜: ì›”ë³„ë°ì´í„°[í˜„ì¬ì›”í‚¤ê°’] ? ì›”ë³„ë°ì´í„°[í˜„ì¬ì›”í‚¤ê°’].ìˆ˜ì….length : 0,
                    ì§€ì¶œê±´ìˆ˜: ì›”ë³„ë°ì´í„°[í˜„ì¬ì›”í‚¤ê°’] ? ì›”ë³„ë°ì´í„°[í˜„ì¬ì›”í‚¤ê°’].ì§€ì¶œ.length : 0,
                    ë§ˆì§€ë§‰ì—…ë°ì´íŠ¸: new Date().toISOString(),
                    ë²„ì „: 'v2.0'
                };
                
                ë¡œê·¸('ğŸ’¾ ì €ì¥í•  ë°ì´í„° êµ¬ì¡°', ì €ì¥ë°ì´í„°);
                
                // localStorageì— ì €ì¥
                localStorage.setItem(STORAGE_KEYS.ì›”ë³„ë°ì´í„°, JSON.stringify(ì €ì¥ë°ì´í„°));
                
                // ìë™ ì €ì¥ í‘œì‹œ
                ìë™ì €ì¥í‘œì‹œ();
                
                // â­ ë¶€ëª¨ ì°½(index.html)ì— ê°•í™”ëœ ë°ì´í„° ì „ì†¡
                if (window.parent !== window) {
                    ë¡œê·¸('ğŸ“¡ ë¶€ëª¨ ì°½ìœ¼ë¡œ ë°ì´í„° ì „ì†¡ ì‹œì‘');
                    
                    // ì—¬ëŸ¬ ê°€ì§€ ë©”ì‹œì§€ íƒ€ì…ìœ¼ë¡œ ì „ì†¡í•˜ì—¬ í™•ì‹¤íˆ ìˆ˜ì‹ ë˜ë„ë¡ í•¨
                    
                    // 1. ê¸°ë³¸ ë°ì´í„° ì—…ë°ì´íŠ¸ ë©”ì‹œì§€
                    window.parent.postMessage({
                        type: 'MODULE2_DATA_UPDATE',
                        data: ì €ì¥ë°ì´í„°
                    }, '*');
                    
                    // 2. ì¦‰ì‹œ ì €ì¥ ì™„ë£Œ ë©”ì‹œì§€
                    window.parent.postMessage({
                        type: 'DATA_SAVED_IMMEDIATE',
                        module: 'module2',
                        data: ì €ì¥ë°ì´í„°
                    }, '*');
                    
                    // 3. ì €ì¥ ì™„ë£Œ ì•Œë¦¼
                    window.parent.postMessage({
                        type: 'DATA_SAVED',
                        module: 'module2'
                    }, '*');
                    
                    ë¡œê·¸('ğŸ“¡ ë¶€ëª¨ ì°½ìœ¼ë¡œ 3ê°€ì§€ ë©”ì‹œì§€ ì „ì†¡ ì™„ë£Œ');
                }
                
                ë¡œê·¸('âœ… ìë™ ì €ì¥ ì™„ë£Œ');
                return true;
                
            } catch (error) {
                ë¡œê·¸('âŒ ìë™ ì €ì¥ ì‹¤íŒ¨', error);
                console.error('ìë™ ì €ì¥ ì‹¤íŒ¨:', error);
                return false;
            }
        }
        
        // ìë™ ì €ì¥ í‘œì‹œ
        function ìë™ì €ì¥í‘œì‹œ() {
            const í‘œì‹œê¸° = document.getElementById('autoSaveIndicator');
            í‘œì‹œê¸°.classList.add('show');
            setTimeout(() => {
                í‘œì‹œê¸°.classList.remove('show');
            }, 2000);
        }
        
        // â­ ê°œì„ ëœ ìë™ ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜
        function ìë™ë¶ˆëŸ¬ì˜¤ê¸°() {
            try {
                ë¡œê·¸('ğŸ“‚ ìë™ ë¶ˆëŸ¬ì˜¤ê¸° ì‹œì‘');
                
                const ì €ì¥ëœë°ì´í„° = localStorage.getItem(STORAGE_KEYS.ì›”ë³„ë°ì´í„°);
                if (ì €ì¥ëœë°ì´í„°) {
                    const ë°ì´í„° = JSON.parse(ì €ì¥ëœë°ì´í„°);
                    ë¡œê·¸('ğŸ“‚ ì €ì¥ëœ ë°ì´í„° ë°œê²¬', ë°ì´í„°);
                    
                    ì›”ë³„ë°ì´í„° = ë°ì´í„°.ì›”ë³„ë°ì´í„° || {};
                    
                    // í˜„ì¬ë…„ì›” ë³µì›
                    if (ë°ì´í„°.í˜„ì¬ë…„ì›”) {
                        í˜„ì¬ë…„ì›” = new Date(ë°ì´í„°.í˜„ì¬ë…„ì›”.year, ë°ì´í„°.í˜„ì¬ë…„ì›”.month);
                    }
                    
                    ë¡œê·¸('âœ… ì €ì¥ëœ ìˆ˜ì…/ì§€ì¶œ ë°ì´í„° ìë™ ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ');
                    
                    // ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
                    const ì´ì›”ìˆ˜ = Object.keys(ì›”ë³„ë°ì´í„°).length;
                    const í˜„ì¬ì›”íˆ¬ìì—¬ë ¥ = íˆ¬ìì—¬ë ¥ê³„ì‚°();
                    
                    document.getElementById('autoSaveStatus').innerHTML = 
                        `ë§ˆì§€ë§‰ ì €ì¥: ${new Date().toLocaleString()}<br>ë“±ë¡ëœ ì›”ìˆ˜: ${ì´ì›”ìˆ˜}ê°œì›”<br>í˜„ì¬ ì›” íˆ¬ìì—¬ë ¥: ${ìˆ«ìí¬ë§·(í˜„ì¬ì›”íˆ¬ìì—¬ë ¥)}ë§Œì›`;
                    
                    return true;  // ì„±ê³µ ì‹œ true ë°˜í™˜
                } else {
                    ë¡œê·¸('âš ï¸ ì €ì¥ëœ ë°ì´í„° ì—†ìŒ');
                    return false;  // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ false ë°˜í™˜
                }
                
            } catch (error) {
                ë¡œê·¸('âŒ ìë™ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨', error);
                console.error('ìë™ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
                return false;  // ì‹¤íŒ¨ ì‹œ false ë°˜í™˜
            }
        }
        
        // window ê°ì²´ì— í•¨ìˆ˜ë“¤ ë…¸ì¶œ (ë¶€ëª¨ ì°½ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡)
        window.ìë™ë¶ˆëŸ¬ì˜¤ê¸° = ìë™ë¶ˆëŸ¬ì˜¤ê¸°;
        window.ì „ì²´ì—…ë°ì´íŠ¸ = ì „ì²´ì—…ë°ì´íŠ¸;
        
        /*
        ===========================================
        ê¸°ë³¸ í•¨ìˆ˜ë“¤
        ===========================================
        */
        
        // ìˆ«ìë¥¼ ì²œë‹¨ìœ„ ì½¤ë§ˆë¡œ í¬ë§·
        function ìˆ«ìí¬ë§·(ìˆ«ì) {
            return ìˆ«ì.toLocaleString();
        }
        
        // í˜„ì¬ ì›”ì˜ í‚¤ ìƒì„±
        function í˜„ì¬ì›”í‚¤() {
            return `${í˜„ì¬ë…„ì›”.getFullYear()}-${String(í˜„ì¬ë…„ì›”.getMonth() + 1).padStart(2, '0')}`;
        }
        
        // ì›”ë³„ ë°ì´í„° ì´ˆê¸°í™”
        function ì›”ë³„ë°ì´í„°ì´ˆê¸°í™”(ì›”í‚¤) {
            if (!ì›”ë³„ë°ì´í„°[ì›”í‚¤]) {
                ì›”ë³„ë°ì´í„°[ì›”í‚¤] = {
                    ìˆ˜ì…: [],
                    ì§€ì¶œ: []
                };
            }
        }
        
        /*
        ===========================================
        ìˆ˜ì…/ì§€ì¶œ ê´€ë¦¬ í•¨ìˆ˜ë“¤ (ìë™ì €ì¥ ê¸°ëŠ¥ ê°•í™”)
        ===========================================
        */
        
        // ìˆ˜ì… ì¶”ê°€
        function ìˆ˜ì…ì¶”ê°€() {
            const í•­ëª© = document.getElementById('incomeItem').value;
            const ìƒì„¸ë‚´ìš© = document.getElementById('incomeDetail').value.trim();
            const ê¸ˆì•¡ = parseFloat(document.getElementById('incomeAmount').value) || 0;
            
            if (!í•­ëª©) {
                alert('ìˆ˜ì… í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (ê¸ˆì•¡ <= 0) {
                alert('ìœ íš¨í•œ ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const ì›”í‚¤ = í˜„ì¬ì›”í‚¤();
            ì›”ë³„ë°ì´í„°ì´ˆê¸°í™”(ì›”í‚¤);
            
            const í‘œì‹œëª… = ìƒì„¸ë‚´ìš© ? `${í•­ëª©} (${ìƒì„¸ë‚´ìš©})` : í•­ëª©;
            
            const ìˆ˜ì…ë°ì´í„° = {
                id: Date.now(),
                í•­ëª©: í•­ëª©,
                ìƒì„¸ë‚´ìš©: ìƒì„¸ë‚´ìš©,
                í‘œì‹œëª…: í‘œì‹œëª…,
                ê¸ˆì•¡: ê¸ˆì•¡,
                ë‚ ì§œ: new Date().toISOString()
            };
            
            ì›”ë³„ë°ì´í„°[ì›”í‚¤].ìˆ˜ì….push(ìˆ˜ì…ë°ì´í„°);
            
            ë¡œê·¸(`ğŸ’¼ ìˆ˜ì… ì¶”ê°€: ${í‘œì‹œëª…} - ${ê¸ˆì•¡}ë§Œì›`);
            
            // í¼ ì´ˆê¸°í™”
            document.getElementById('incomeItem').value = '';
            document.getElementById('incomeDetail').value = '';
            document.getElementById('incomeAmount').value = '';
            
            // â­ ìë™ ì €ì¥ ë° ì¦‰ì‹œ ë™ê¸°í™”
            ìë™ì €ì¥();
            
            ì „ì²´ì—…ë°ì´íŠ¸();
            alert(`${í‘œì‹œëª…}: ${ìˆ«ìí¬ë§·(ê¸ˆì•¡)}ë§Œì›ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }
        
        // ì§€ì¶œ ì¶”ê°€
        function ì§€ì¶œì¶”ê°€() {
            const í•­ëª© = document.getElementById('expenseItem').value;
            const ìƒì„¸ë‚´ìš© = document.getElementById('expenseDetail').value.trim();
            const ê¸ˆì•¡ = parseFloat(document.getElementById('expenseAmount').value) || 0;
            
            if (!í•­ëª©) {
                alert('ì§€ì¶œ í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (ê¸ˆì•¡ <= 0) {
                alert('ìœ íš¨í•œ ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const ì›”í‚¤ = í˜„ì¬ì›”í‚¤();
            ì›”ë³„ë°ì´í„°ì´ˆê¸°í™”(ì›”í‚¤);
            
            const í‘œì‹œëª… = ìƒì„¸ë‚´ìš© ? `${í•­ëª©} (${ìƒì„¸ë‚´ìš©})` : í•­ëª©;
            
            const ì§€ì¶œë°ì´í„° = {
                id: Date.now(),
                í•­ëª©: í•­ëª©,
                ìƒì„¸ë‚´ìš©: ìƒì„¸ë‚´ìš©,
                í‘œì‹œëª…: í‘œì‹œëª…,
                ê¸ˆì•¡: ê¸ˆì•¡,
                ë‚ ì§œ: new Date().toISOString()
            };
            
            ì›”ë³„ë°ì´í„°[ì›”í‚¤].ì§€ì¶œ.push(ì§€ì¶œë°ì´í„°);
            
            ë¡œê·¸(`ğŸ’³ ì§€ì¶œ ì¶”ê°€: ${í‘œì‹œëª…} - ${ê¸ˆì•¡}ë§Œì›`);
            
            // í¼ ì´ˆê¸°í™”
            document.getElementById('expenseItem').value = '';
            document.getElementById('expenseDetail').value = '';
            document.getElementById('expenseAmount').value = '';
            
            // â­ ìë™ ì €ì¥ ë° ì¦‰ì‹œ ë™ê¸°í™”
            ìë™ì €ì¥();
            
            ì „ì²´ì—…ë°ì´íŠ¸();
            alert(`${í‘œì‹œëª…}: ${ìˆ«ìí¬ë§·(ê¸ˆì•¡)}ë§Œì›ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }
        
        // ìˆ˜ì… ì‚­ì œ
        function ìˆ˜ì…ì‚­ì œ(id) {
            if (confirm('ì´ ìˆ˜ì… í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                const ì›”í‚¤ = í˜„ì¬ì›”í‚¤();
                if (ì›”ë³„ë°ì´í„°[ì›”í‚¤]) {
                    ì›”ë³„ë°ì´í„°[ì›”í‚¤].ìˆ˜ì… = ì›”ë³„ë°ì´í„°[ì›”í‚¤].ìˆ˜ì….filter(item => item.id !== id);
                    
                    ë¡œê·¸(`ğŸ—‘ï¸ ìˆ˜ì… ì‚­ì œ: ID ${id}`);
                    
                    // â­ ìë™ ì €ì¥ ë° ì¦‰ì‹œ ë™ê¸°í™”
                    ìë™ì €ì¥();
                    
                    ì „ì²´ì—…ë°ì´íŠ¸();
                }
            }
        }
        
        // ì§€ì¶œ ì‚­ì œ
        function ì§€ì¶œì‚­ì œ(id) {
            if (confirm('ì´ ì§€ì¶œ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                const ì›”í‚¤ = í˜„ì¬ì›”í‚¤();
                if (ì›”ë³„ë°ì´í„°[ì›”í‚¤]) {
                    ì›”ë³„ë°ì´í„°[ì›”í‚¤].ì§€ì¶œ = ì›”ë³„ë°ì´í„°[ì›”í‚¤].ì§€ì¶œ.filter(item => item.id !== id);
                    
                    ë¡œê·¸(`ğŸ—‘ï¸ ì§€ì¶œ ì‚­ì œ: ID ${id}`);
                    
                    // â­ ìë™ ì €ì¥ ë° ì¦‰ì‹œ ë™ê¸°í™”
                    ìë™ì €ì¥();
                    
                    ì „ì²´ì—…ë°ì´íŠ¸();
                }
            }
        }
        
        /*
        ===========================================
        ê³„ì‚° í•¨ìˆ˜ë“¤
        ===========================================
        */
        
        // ì›” ì´ ìˆ˜ì… ê³„ì‚°
        function ì›”ì´ìˆ˜ì…ê³„ì‚°() {
            const ì›”í‚¤ = í˜„ì¬ì›”í‚¤();
            if (!ì›”ë³„ë°ì´í„°[ì›”í‚¤]) return 0;
            return ì›”ë³„ë°ì´í„°[ì›”í‚¤].ìˆ˜ì….reduce((sum, item) => sum + item.ê¸ˆì•¡, 0);
        }
        
        // ì›” ì´ ì§€ì¶œ ê³„ì‚°
        function ì›”ì´ì§€ì¶œê³„ì‚°() {
            const ì›”í‚¤ = í˜„ì¬ì›”í‚¤();
            if (!ì›”ë³„ë°ì´í„°[ì›”í‚¤]) return 0;
            return ì›”ë³„ë°ì´í„°[ì›”í‚¤].ì§€ì¶œ.reduce((sum, item) => sum + item.ê¸ˆì•¡, 0);
        }
        
        // íˆ¬ìì—¬ë ¥ ê³„ì‚°
        function íˆ¬ìì—¬ë ¥ê³„ì‚°() {
            return ì›”ì´ìˆ˜ì…ê³„ì‚°() - ì›”ì´ì§€ì¶œê³„ì‚°();
        }
        
        // í•­ëª©ë³„ ìˆ˜ì… í•©ê³„
        function í•­ëª©ë³„ìˆ˜ì…() {
            const ì›”í‚¤ = í˜„ì¬ì›”í‚¤();
            if (!ì›”ë³„ë°ì´í„°[ì›”í‚¤]) return {};
            
            const í•­ëª©í•©ê³„ = {};
            ì›”ë³„ë°ì´í„°[ì›”í‚¤].ìˆ˜ì….forEach(item => {
                í•­ëª©í•©ê³„[item.í•­ëª©] = (í•­ëª©í•©ê³„[item.í•­ëª©] || 0) + item.ê¸ˆì•¡;
            });
            return í•­ëª©í•©ê³„;
        }
        
        // í•­ëª©ë³„ ì§€ì¶œ í•©ê³„
        function í•­ëª©ë³„ì§€ì¶œ() {
            const ì›”í‚¤ = í˜„ì¬ì›”í‚¤();
            if (!ì›”ë³„ë°ì´í„°[ì›”í‚¤]) return {};
            
            const í•­ëª©í•©ê³„ = {};
            ì›”ë³„ë°ì´í„°[ì›”í‚¤].ì§€ì¶œ.forEach(item => {
                í•­ëª©í•©ê³„[item.í•­ëª©] = (í•­ëª©í•©ê³„[item.í•­ëª©] || 0) + item.ê¸ˆì•¡;
            });
            return í•­ëª©í•©ê³„;
        }
        
        /*
        ===========================================
        ë„¤ë¹„ê²Œì´ì…˜ í•¨ìˆ˜ë“¤
        ===========================================
        */
        
        // íƒ­ ë³€ê²½
        function íƒ­ë³€ê²½(íƒ­ì´ë¦„) {
            // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            event.target.classList.add('active');
            document.getElementById(íƒ­ì´ë¦„).classList.add('active');
            
            // ë¶„ì„ íƒ­ ì„ íƒ ì‹œ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            if (íƒ­ì´ë¦„ === 'analysis') {
                setTimeout(() => {
                    ìˆ˜ì…ì°¨íŠ¸ìƒì„±();
                    ì§€ì¶œì°¨íŠ¸ìƒì„±();
                    ì¶”ì´ì°¨íŠ¸ìƒì„±();
                }, 100);
            }
            
            // ë°ì´í„° ê´€ë¦¬ íƒ­ ì„ íƒ ì‹œ ë°ì´í„° í˜„í™© ì—…ë°ì´íŠ¸
            if (íƒ­ì´ë¦„ === 'data') {
                setTimeout(() => {
                    ë°ì´í„°í˜„í™©ì—…ë°ì´íŠ¸();
                    ì›”ë³„ë°ì´í„°ìš”ì•½ì—…ë°ì´íŠ¸();
                }, 100);
            }
        }
        
        // ì´ì „ì›”ë¡œ ì´ë™
        function ì´ì „ì›”() {
            í˜„ì¬ë…„ì›”.setMonth(í˜„ì¬ë…„ì›”.getMonth() - 1);
            
            ë¡œê·¸(`ğŸ“… ì´ì „ì›” ì´ë™: ${í˜„ì¬ì›”í‚¤()}`);
            
            // â­ ìë™ ì €ì¥ ë° ì¦‰ì‹œ ë™ê¸°í™”
            ìë™ì €ì¥();
            
            ì „ì²´ì—…ë°ì´íŠ¸();
        }
        
        // ë‹¤ìŒì›”ë¡œ ì´ë™
        function ë‹¤ìŒì›”() {
            í˜„ì¬ë…„ì›”.setMonth(í˜„ì¬ë…„ì›”.getMonth() + 1);
            
            ë¡œê·¸(`ğŸ“… ë‹¤ìŒì›” ì´ë™: ${í˜„ì¬ì›”í‚¤()}`);
            
            // â­ ìë™ ì €ì¥ ë° ì¦‰ì‹œ ë™ê¸°í™”
            ìë™ì €ì¥();
            
            ì „ì²´ì—…ë°ì´íŠ¸();
        }
        
        /*
        ===========================================
        ì°¨íŠ¸ ìƒì„± í•¨ìˆ˜ë“¤
        ===========================================
        */
        
        // ìˆ˜ì… ì°¨íŠ¸ ìƒì„±
        function ìˆ˜ì…ì°¨íŠ¸ìƒì„±() {
            const ctx = document.getElementById('incomeChart').getContext('2d');
            
            if (ìˆ˜ì…ì°¨íŠ¸) {
                ìˆ˜ì…ì°¨íŠ¸.destroy();
            }
            
            const í•­ëª©ë°ì´í„° = í•­ëª©ë³„ìˆ˜ì…();
            const ë¼ë²¨ = Object.keys(í•­ëª©ë°ì´í„°);
            const ë°ì´í„° = Object.values(í•­ëª©ë°ì´í„°);
            
            if (ë¼ë²¨.length === 0) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.fillStyle = '#666';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ìˆ˜ì… ë°ì´í„°ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”', ctx.canvas.width/2, ctx.canvas.height/2);
                return;
            }
            
            ìˆ˜ì…ì°¨íŠ¸ = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ë¼ë²¨,
                    datasets: [{
                        data: ë°ì´í„°,
                        backgroundColor: ìˆ˜ì…ìƒ‰ìƒ,
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const ì´ì•¡ = ë°ì´í„°.reduce((sum, val) => sum + val, 0);
                                    const ë¹„ìœ¨ = (context.parsed / ì´ì•¡ * 100).toFixed(1);
                                    return `${context.label}: ${ìˆ«ìí¬ë§·(context.parsed)}ë§Œì› (${ë¹„ìœ¨}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // ì§€ì¶œ ì°¨íŠ¸ ìƒì„±
        function ì§€ì¶œì°¨íŠ¸ìƒì„±() {
            const ctx = document.getElementById('expenseChart').getContext('2d');
            
            if (ì§€ì¶œì°¨íŠ¸) {
                ì§€ì¶œì°¨íŠ¸.destroy();
            }
            
            const í•­ëª©ë°ì´í„° = í•­ëª©ë³„ì§€ì¶œ();
            const ë¼ë²¨ = Object.keys(í•­ëª©ë°ì´í„°);
            const ë°ì´í„° = Object.values(í•­ëª©ë°ì´í„°);
            
            if (ë¼ë²¨.length === 0) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.fillStyle = '#666';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ì§€ì¶œ ë°ì´í„°ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”', ctx.canvas.width/2, ctx.canvas.height/2);
                return;
            }
            
            ì§€ì¶œì°¨íŠ¸ = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ë¼ë²¨,
                    datasets: [{
                        data: ë°ì´í„°,
                        backgroundColor: ì§€ì¶œìƒ‰ìƒ,
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const ì´ì•¡ = ë°ì´í„°.reduce((sum, val) => sum + val, 0);
                                    const ë¹„ìœ¨ = (context.parsed / ì´ì•¡ * 100).toFixed(1);
                                    return `${context.label}: ${ìˆ«ìí¬ë§·(context.parsed)}ë§Œì› (${ë¹„ìœ¨}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // ì›”ë³„ ì¶”ì´ ì°¨íŠ¸ ìƒì„±
        function ì¶”ì´ì°¨íŠ¸ìƒì„±() {
            const ctx = document.getElementById('trendChart').getContext('2d');
            
            if (ì¶”ì´ì°¨íŠ¸) {
                ì¶”ì´ì°¨íŠ¸.destroy();
            }
            
            // ìµœê·¼ 12ê°œì›” ë°ì´í„° ì¤€ë¹„
            const ì›”ë°ì´í„° = [];
            const ìˆ˜ì…ë°ì´í„° = [];
            const ì§€ì¶œë°ì´í„° = [];
            const íˆ¬ìì—¬ë ¥ë°ì´í„° = [];
            
            for (let i = 11; i >= 0; i--) {
                const ë‚ ì§œ = new Date();
                ë‚ ì§œ.setMonth(ë‚ ì§œ.getMonth() - i);
                const ì›”í‚¤ = `${ë‚ ì§œ.getFullYear()}-${String(ë‚ ì§œ.getMonth() + 1).padStart(2, '0')}`;
                
                ì›”ë°ì´í„°.push(`${ë‚ ì§œ.getFullYear()}ë…„ ${ë‚ ì§œ.getMonth() + 1}ì›”`);
                
                if (ì›”ë³„ë°ì´í„°[ì›”í‚¤]) {
                    const ìˆ˜ì… = ì›”ë³„ë°ì´í„°[ì›”í‚¤].ìˆ˜ì….reduce((sum, item) => sum + item.ê¸ˆì•¡, 0);
                    const ì§€ì¶œ = ì›”ë³„ë°ì´í„°[ì›”í‚¤].ì§€ì¶œ.reduce((sum, item) => sum + item.ê¸ˆì•¡, 0);
                    ìˆ˜ì…ë°ì´í„°.push(ìˆ˜ì…);
                    ì§€ì¶œë°ì´í„°.push(ì§€ì¶œ);
                    íˆ¬ìì—¬ë ¥ë°ì´í„°.push(ìˆ˜ì… - ì§€ì¶œ);
                } else {
                    ìˆ˜ì…ë°ì´í„°.push(0);
                    ì§€ì¶œë°ì´í„°.push(0);
                    íˆ¬ìì—¬ë ¥ë°ì´í„°.push(0);
                }
            }
            
            ì¶”ì´ì°¨íŠ¸ = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ì›”ë°ì´í„°,
                    datasets: [{
                        label: 'ì›” ìˆ˜ì…',
                        data: ìˆ˜ì…ë°ì´í„°,
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        tension: 0.1
                    }, {
                        label: 'ì›” ì§€ì¶œ',
                        data: ì§€ì¶œë°ì´í„°,
                        borderColor: '#dc3545',
                        backgroundColor: 'rgba(220, 53, 69, 0.1)',
                        tension: 0.1
                    }, {
                        label: 'íˆ¬ìì—¬ë ¥',
                        data: íˆ¬ìì—¬ë ¥ë°ì´í„°,
                        borderColor: '#007bff',
                        backgroundColor: 'rgba(0, 123, 255, 0.1)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${ìˆ«ìí¬ë§·(context.parsed.y)}ë§Œì›`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return ìˆ«ìí¬ë§·(value) + 'ë§Œì›';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        /*
        ===========================================
        í™”ë©´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë“¤
        ===========================================
        */
        
        // í—¤ë” ìš”ì•½ ì •ë³´ ì—…ë°ì´íŠ¸
        function í—¤ë”ìš”ì•½ì—…ë°ì´íŠ¸() {
            const ì´ìˆ˜ì… = ì›”ì´ìˆ˜ì…ê³„ì‚°();
            const ì´ì§€ì¶œ = ì›”ì´ì§€ì¶œê³„ì‚°();
            const íˆ¬ìì—¬ë ¥ = íˆ¬ìì—¬ë ¥ê³„ì‚°();
            
            document.getElementById('totalIncome').textContent = `${ìˆ«ìí¬ë§·(ì´ìˆ˜ì…)}ë§Œì›`;
            document.getElementById('totalExpense').textContent = `${ìˆ«ìí¬ë§·(ì´ì§€ì¶œ)}ë§Œì›`;
            document.getElementById('investmentCapacity').textContent = `${ìˆ«ìí¬ë§·(íˆ¬ìì—¬ë ¥)}ë§Œì›`;
            
            ë¡œê·¸('ğŸ“Š í—¤ë” ìš”ì•½ ì—…ë°ì´íŠ¸', { ì´ìˆ˜ì…, ì´ì§€ì¶œ, íˆ¬ìì—¬ë ¥ });
        }
        
        // í˜„ì¬ ì›” í‘œì‹œ ì—…ë°ì´íŠ¸
        function í˜„ì¬ì›”í‘œì‹œì—…ë°ì´íŠ¸() {
            const ë…„ = í˜„ì¬ë…„ì›”.getFullYear();
            const ì›” = í˜„ì¬ë…„ì›”.getMonth() + 1;
            document.getElementById('currentMonth').textContent = `${ë…„}ë…„ ${ì›”}ì›”`;
        }
        
        // ìˆ˜ì… ëª©ë¡ í‘œì‹œ
        function ìˆ˜ì…ëª©ë¡í‘œì‹œ() {
            const ì»¨í…Œì´ë„ˆ = document.getElementById('incomeList');
            ì»¨í…Œì´ë„ˆ.innerHTML = '';
            
            const ì›”í‚¤ = í˜„ì¬ì›”í‚¤();
            if (!ì›”ë³„ë°ì´í„°[ì›”í‚¤] || ì›”ë³„ë°ì´í„°[ì›”í‚¤].ìˆ˜ì….length === 0) {
                ì»¨í…Œì´ë„ˆ.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">ì•„ì§ ìˆ˜ì… ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            ì›”ë³„ë°ì´í„°[ì›”í‚¤].ìˆ˜ì….forEach(item => {
                const í•­ëª©ìš”ì†Œ = document.createElement('div');
                í•­ëª©ìš”ì†Œ.className = 'list-item';
                í•­ëª©ìš”ì†Œ.innerHTML = `
                    <div class="item-info">
                        <div class="item-name">${item.í‘œì‹œëª…}</div>
                        ${item.ìƒì„¸ë‚´ìš© ? `<div class="item-category">${item.ìƒì„¸ë‚´ìš©}</div>` : ''}
                    </div>
                    <div class="item-amount income-amount">+${ìˆ«ìí¬ë§·(item.ê¸ˆì•¡)}ë§Œì›</div>
                    <div class="item-actions">
                        <button class="btn btn-danger btn-small" onclick="ìˆ˜ì…ì‚­ì œ(${item.id})">ì‚­ì œ</button>
                    </div>
                `;
                ì»¨í…Œì´ë„ˆ.appendChild(í•­ëª©ìš”ì†Œ);
            });
        }
        
        // ì§€ì¶œ ëª©ë¡ í‘œì‹œ
        function ì§€ì¶œëª©ë¡í‘œì‹œ() {
            const ì»¨í…Œì´ë„ˆ = document.getElementById('expenseList');
            ì»¨í…Œì´ë„ˆ.innerHTML = '';
            
            const ì›”í‚¤ = í˜„ì¬ì›”í‚¤();
            if (!ì›”ë³„ë°ì´í„°[ì›”í‚¤] || ì›”ë³„ë°ì´í„°[ì›”í‚¤].ì§€ì¶œ.length === 0) {
                ì»¨í…Œì´ë„ˆ.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">ì•„ì§ ì§€ì¶œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            ì›”ë³„ë°ì´í„°[ì›”í‚¤].ì§€ì¶œ.forEach(item => {
                const í•­ëª©ìš”ì†Œ = document.createElement('div');
                í•­ëª©ìš”ì†Œ.className = 'list-item';
                í•­ëª©ìš”ì†Œ.innerHTML = `
                    <div class="item-info">
                        <div class="item-name">${item.í‘œì‹œëª…}</div>
                        ${item.ìƒì„¸ë‚´ìš© ? `<div class="item-category">${item.ìƒì„¸ë‚´ìš©}</div>` : ''}
                    </div>
                    <div class="item-amount expense-amount">-${ìˆ«ìí¬ë§·(item.ê¸ˆì•¡)}ë§Œì›</div>
                    <div class="item-actions">
                        <button class="btn btn-danger btn-small" onclick="ì§€ì¶œì‚­ì œ(${item.id})">ì‚­ì œ</button>
                    </div>
                `;
                ì»¨í…Œì´ë„ˆ.appendChild(í•­ëª©ìš”ì†Œ);
            });
        }
        
        /*
        ===========================================
        ë°ì´í„° ê´€ë¦¬ í•¨ìˆ˜ë“¤ (ìë™ì €ì¥ ê¸°ëŠ¥ ê°•í™”)
        ===========================================
        */
        
        // ë°ì´í„° ì €ì¥
        function ë°ì´í„°ì €ì¥() {
            const ì €ì¥ë°ì´í„° = {
                ì›”ë³„ë°ì´í„°: ì›”ë³„ë°ì´í„°,
                ì €ì¥ì¼ì‹œ: new Date().toISOString(),
                ì‹œìŠ¤í…œë²„ì „: "ëª¨ë“ˆ2_ìˆ˜ì…ì§€ì¶œê´€ë¦¬_v2.0"
            };
            
            const ë°ì´í„°ë¬¸ìì—´ = JSON.stringify(ì €ì¥ë°ì´í„°, null, 2);
            const ë¸”ë¡­ = new Blob([ë°ì´í„°ë¬¸ìì—´], { type: 'application/json' });
            const url = URL.createObjectURL(ë¸”ë¡­);
            
            const ë§í¬ = document.createElement('a');
            ë§í¬.href = url;
            const ì˜¤ëŠ˜ = new Date().toISOString().split('T')[0];
            ë§í¬.download = `ìˆ˜ì…ì§€ì¶œë°ì´í„°_${ì˜¤ëŠ˜}.json`;
            ë§í¬.click();
            
            URL.revokeObjectURL(url);
            alert('ğŸ’¾ ìˆ˜ì…/ì§€ì¶œ ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        // ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° íŠ¸ë¦¬ê±°
        function ë°ì´í„°ë¶ˆëŸ¬ì˜¤ê¸°() {
            document.getElementById('fileInput').click();
        }
        
        // íŒŒì¼ì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        function íŒŒì¼ë¶ˆëŸ¬ì˜¤ê¸°(event) {
            const íŒŒì¼ = event.target.files[0];
            if (!íŒŒì¼) return;
            
            const ë¦¬ë” = new FileReader();
            ë¦¬ë”.onload = function(e) {
                try {
                    const ë¶ˆëŸ¬ì˜¨ë°ì´í„° = JSON.parse(e.target.result);
                    
                    if (!ë¶ˆëŸ¬ì˜¨ë°ì´í„°.ì›”ë³„ë°ì´í„°) {
                        alert('âŒ ì˜¬ë°”ë¥¸ ìˆ˜ì…/ì§€ì¶œ ë°ì´í„° íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.');
                        return;
                    }
                    
                    if (confirm('ê¸°ì¡´ ë°ì´í„°ë¥¼ ëª¨ë‘ ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?\n\ní˜„ì¬ ë°ì´í„°ëŠ” ëª¨ë‘ ì‚­ì œë˜ê³  ë¶ˆëŸ¬ì˜¨ ë°ì´í„°ë¡œ êµì²´ë©ë‹ˆë‹¤.')) {
                        ì›”ë³„ë°ì´í„° = ë¶ˆëŸ¬ì˜¨ë°ì´í„°.ì›”ë³„ë°ì´í„° || {};
                        
                        ë¡œê·¸('ğŸ“‚ íŒŒì¼ì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ', ì›”ë³„ë°ì´í„°);
                        
                        // â­ ìë™ ì €ì¥ ë° ì¦‰ì‹œ ë™ê¸°í™”
                        ìë™ì €ì¥();
                        
                        ì „ì²´ì—…ë°ì´íŠ¸();
                        ë°ì´í„°í˜„í™©ì—…ë°ì´íŠ¸();
                        alert('ğŸ“‚ ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™€ì¡ŒìŠµë‹ˆë‹¤.');
                    }
                } catch (error) {
                    alert('âŒ íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì˜¬ë°”ë¥¸ JSON íŒŒì¼ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
                    ë¡œê·¸('âŒ íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜', error);
                }
            };
            ë¦¬ë”.readAsText(íŒŒì¼);
            
            // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
            event.target.value = '';
        }
        
        // ë°ì´í„° ì´ˆê¸°í™”
        function ë°ì´í„°ì´ˆê¸°í™”() {
            if (confirm('âš ï¸ ëª¨ë“  ìˆ˜ì…/ì§€ì¶œ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                if (confirm('ì •ë§ í™•ì‹¤í•˜ì‹œë‚˜ìš”? ëª¨ë“  ì›”ë³„ ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.')) {
                    ì›”ë³„ë°ì´í„° = {};
                    
                    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ë„ ì´ˆê¸°í™”
                    Object.values(STORAGE_KEYS).forEach(key => {
                        localStorage.removeItem(key);
                    });
                    
                    ë¡œê·¸('ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ');
                    
                    // â­ ë¹ˆ ë°ì´í„°ë¡œ ìë™ ì €ì¥ ë° ë™ê¸°í™”
                    ìë™ì €ì¥();
                    
                    ì „ì²´ì—…ë°ì´íŠ¸();
                    ë°ì´í„°í˜„í™©ì—…ë°ì´íŠ¸();
                    alert('ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            }
        }
        
        // ë°ì´í„° í˜„í™© ì—…ë°ì´íŠ¸
        function ë°ì´í„°í˜„í™©ì—…ë°ì´íŠ¸() {
            const ì»¨í…Œì´ë„ˆ = document.getElementById('dataStatus');
            const ì´ì›”ìˆ˜ = Object.keys(ì›”ë³„ë°ì´í„°).length;
            
            let ì´ìˆ˜ì…í•­ëª© = 0;
            let ì´ì§€ì¶œí•­ëª© = 0;
            let ì´ìˆ˜ì…ê¸ˆì•¡ = 0;
            let ì´ì§€ì¶œê¸ˆì•¡ = 0;
            
            for (const [ì›”í‚¤, ë°ì´í„°] of Object.entries(ì›”ë³„ë°ì´í„°)) {
                ì´ìˆ˜ì…í•­ëª© += ë°ì´í„°.ìˆ˜ì….length;
                ì´ì§€ì¶œí•­ëª© += ë°ì´í„°.ì§€ì¶œ.length;
                ì´ìˆ˜ì…ê¸ˆì•¡ += ë°ì´í„°.ìˆ˜ì….reduce((sum, item) => sum + item.ê¸ˆì•¡, 0);
                ì´ì§€ì¶œê¸ˆì•¡ += ë°ì´í„°.ì§€ì¶œ.reduce((sum, item) => sum + item.ê¸ˆì•¡, 0);
            }
            
            ì»¨í…Œì´ë„ˆ.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; text-align: center;">
                    <div>
                        <div style="font-size: 2em; color: #28a745; font-weight: bold;">${ì´ì›”ìˆ˜}</div>
                        <div style="color: #666;">ë“±ë¡ëœ ì›”ìˆ˜</div>
                    </div>
                    <div>
                        <div style="font-size: 2em; color: #007bff; font-weight: bold;">${ì´ìˆ˜ì…í•­ëª©}</div>
                        <div style="color: #666;">ì´ ìˆ˜ì… í•­ëª©</div>
                    </div>
                    <div>
                        <div style="font-size: 2em; color: #dc3545; font-weight: bold;">${ì´ì§€ì¶œí•­ëª©}</div>
                        <div style="color: #666;">ì´ ì§€ì¶œ í•­ëª©</div>
                    </div>
                    <div>
                        <div style="font-size: 1.5em; color: #28a745; font-weight: bold;">+${ìˆ«ìí¬ë§·(ì´ìˆ˜ì…ê¸ˆì•¡)}ë§Œì›</div>
                        <div style="color: #666;">ëˆ„ì  ì´ìˆ˜ì…</div>
                    </div>
                    <div>
                        <div style="font-size: 1.5em; color: #dc3545; font-weight: bold;">-${ìˆ«ìí¬ë§·(ì´ì§€ì¶œê¸ˆì•¡)}ë§Œì›</div>
                        <div style="color: #666;">ëˆ„ì  ì´ì§€ì¶œ</div>
                    </div>
                    <div>
                        <div style="font-size: 1.5em; color: #007bff; font-weight: bold;">${ìˆ«ìí¬ë§·(ì´ìˆ˜ì…ê¸ˆì•¡ - ì´ì§€ì¶œê¸ˆì•¡)}ë§Œì›</div>
                        <div style="color: #666;">ëˆ„ì  ìˆœìˆ˜ìµ</div>
                    </div>
                </div>
            `;
        }
        
        // ì›”ë³„ ë°ì´í„° ìš”ì•½ ì—…ë°ì´íŠ¸
        function ì›”ë³„ë°ì´í„°ìš”ì•½ì—…ë°ì´íŠ¸() {
            const ì»¨í…Œì´ë„ˆ = document.getElementById('monthlyDataSummary');
            
            if (Object.keys(ì›”ë³„ë°ì´í„°).length === 0) {
                ì»¨í…Œì´ë„ˆ.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">ì•„ì§ ë“±ë¡ëœ ì›”ë³„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            // ì›”ë³„ ë°ì´í„°ë¥¼ ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬
            const ì •ë ¬ëœì›”í‚¤ = Object.keys(ì›”ë³„ë°ì´í„°).sort().reverse();
            
            let ìš”ì•½HTML = '<div style="display: grid; gap: 15px;">';
            
            ì •ë ¬ëœì›”í‚¤.forEach(ì›”í‚¤ => {
                const ë°ì´í„° = ì›”ë³„ë°ì´í„°[ì›”í‚¤];
                const ì›”ìˆ˜ì… = ë°ì´í„°.ìˆ˜ì….reduce((sum, item) => sum + item.ê¸ˆì•¡, 0);
                const ì›”ì§€ì¶œ = ë°ì´í„°.ì§€ì¶œ.reduce((sum, item) => sum + item.ê¸ˆì•¡, 0);
                const ì›”íˆ¬ìì—¬ë ¥ = ì›”ìˆ˜ì… - ì›”ì§€ì¶œ;
                
                const [ë…„, ì›”] = ì›”í‚¤.split('-');
                const ì›”í‘œì‹œ = `${ë…„}ë…„ ${parseInt(ì›”)}ì›”`;
                
                ìš”ì•½HTML += `
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #007bff;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: bold; font-size: 1.1em; color: #333;">${ì›”í‘œì‹œ}</div>
                                <div style="font-size: 0.9em; color: #666;">ìˆ˜ì… ${ë°ì´í„°.ìˆ˜ì….length}ê±´ Â· ì§€ì¶œ ${ë°ì´í„°.ì§€ì¶œ.length}ê±´</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="color: #28a745;">ìˆ˜ì…: +${ìˆ«ìí¬ë§·(ì›”ìˆ˜ì…)}ë§Œì›</div>
                                <div style="color: #dc3545;">ì§€ì¶œ: -${ìˆ«ìí¬ë§·(ì›”ì§€ì¶œ)}ë§Œì›</div>
                                <div style="color: #007bff; font-weight: bold;">íˆ¬ìì—¬ë ¥: ${ìˆ«ìí¬ë§·(ì›”íˆ¬ìì—¬ë ¥)}ë§Œì›</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            ìš”ì•½HTML += '</div>';
            ì»¨í…Œì´ë„ˆ.innerHTML = ìš”ì•½HTML;
        }
        
        /*
        ===========================================
        ì „ì²´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        ===========================================
        */
        
        function ì „ì²´ì—…ë°ì´íŠ¸() {
            í˜„ì¬ì›”í‘œì‹œì—…ë°ì´íŠ¸();
            í—¤ë”ìš”ì•½ì—…ë°ì´íŠ¸();
            ìˆ˜ì…ëª©ë¡í‘œì‹œ();
            ì§€ì¶œëª©ë¡í‘œì‹œ();
        }
        
        /*
        ===========================================
        â­ ê°•í™”ëœ ì´ˆê¸°í™” í•¨ìˆ˜
        ===========================================
        */
        
        // ìƒ˜í”Œ ë°ì´í„° ë¡œë“œ (í…ŒìŠ¤íŠ¸ìš©)
        function ìƒ˜í”Œë°ì´í„°ë¡œë“œ() {
            const ì›”í‚¤ = í˜„ì¬ì›”í‚¤();
            ì›”ë³„ë°ì´í„°[ì›”í‚¤] = {
                ìˆ˜ì…: [
                    { id: 1751198811355, í•­ëª©: 'ë³‘ì›ê¸‰ì—¬', ìƒì„¸ë‚´ìš©: '', í‘œì‹œëª…: 'ë³‘ì›ê¸‰ì—¬', ê¸ˆì•¡: 3100, ë‚ ì§œ: new Date().toISOString() },
                    { id: 1751198816838, í•­ëª©: 'ë³´ê±´ì†Œ', ìƒì„¸ë‚´ìš©: '', í‘œì‹œëª…: 'ë³´ê±´ì†Œ', ê¸ˆì•¡: 33, ë‚ ì§œ: new Date().toISOString() },
                    { id: 1751198838159, í•­ëª©: 'í‰ì°½ì†Œë°©ì„œ', ìƒì„¸ë‚´ìš©: '', í‘œì‹œëª…: 'í‰ì°½ì†Œë°©ì„œ', ê¸ˆì•¡: 43, ë‚ ì§œ: new Date().toISOString() },
                    { id: 1751198844720, í•­ëª©: 'ê°•ì›ìƒí™©ì‹¤', ìƒì„¸ë‚´ìš©: '', í‘œì‹œëª…: 'ê°•ì›ìƒí™©ì‹¤', ê¸ˆì•¡: 82, ë‚ ì§œ: new Date().toISOString() },
                    { id: 1751198857007, í•­ëª©: 'ê¸°íƒ€', ìƒì„¸ë‚´ìš©: 'ì›ì£¼ì„¸ë¸Œë€ìŠ¤', í‘œì‹œëª…: 'ê¸°íƒ€ (ì›ì£¼ì„¸ë¸Œë€ìŠ¤)', ê¸ˆì•¡: 10, ë‚ ì§œ: new Date().toISOString() }
                ],
                ì§€ì¶œ: [
                    { id: 1751198879690, í•­ëª©: 'ì‚¼ì„±ì¹´ë“œ', ìƒì„¸ë‚´ìš©: '', í‘œì‹œëª…: 'ì‚¼ì„±ì¹´ë“œ', ê¸ˆì•¡: 566, ë‚ ì§œ: new Date().toISOString() },
                    { id: 1751198886157, í•­ëª©: 'í˜„ëŒ€ì¹´ë“œ', ìƒì„¸ë‚´ìš©: '', í‘œì‹œëª…: 'í˜„ëŒ€ì¹´ë“œ', ê¸ˆì•¡: 135, ë‚ ì§œ: new Date().toISOString() },
                    { id: 1751198893185, í•­ëª©: 'í•˜ë‚˜ì¹´ë“œ', ìƒì„¸ë‚´ìš©: '', í‘œì‹œëª…: 'í•˜ë‚˜ì¹´ë“œ', ê¸ˆì•¡: 31, ë‚ ì§œ: new Date().toISOString() },
                    { id: 1751198900468, í•­ëª©: 'ìƒí™œë¹„', ìƒì„¸ë‚´ìš©: '', í‘œì‹œëª…: 'ìƒí™œë¹„', ê¸ˆì•¡: 300, ë‚ ì§œ: new Date().toISOString() },
                    { id: 1751198909810, í•­ëª©: 'ê¸°íƒ€', ìƒì„¸ë‚´ìš©: 'ì£¼í¬ ISA', í‘œì‹œëª…: 'ê¸°íƒ€ (ì£¼í¬ ISA)', ê¸ˆì•¡: 1000, ë‚ ì§œ: new Date().toISOString() }
                ]
            };
            
            ë¡œê·¸('ğŸ”„ ìƒ˜í”Œ ë°ì´í„° ë¡œë“œ ì™„ë£Œ', ì›”ë³„ë°ì´í„°[ì›”í‚¤]);
            
            // â­ ìë™ ì €ì¥ ë° ì¦‰ì‹œ ë™ê¸°í™”
            ìë™ì €ì¥();
            
            ì „ì²´ì—…ë°ì´íŠ¸();
            alert('ğŸ”„ ìƒ˜í”Œ ë°ì´í„°ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        // â­ ê°•í™”ëœ ì‹œìŠ¤í…œ ì´ˆê¸°í™” í•¨ìˆ˜
        function ì‹œìŠ¤í…œì´ˆê¸°í™”() {
            ë¡œê·¸('ğŸš€ ìˆ˜ì…/ì§€ì¶œ ê´€ë¦¬ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹œì‘...');
            
            // 1ë‹¨ê³„: ì €ì¥ëœ ë°ì´í„° ìë™ ë¶ˆëŸ¬ì˜¤ê¸°
            const ë°ì´í„°ë¡œë“œì„±ê³µ = ìë™ë¶ˆëŸ¬ì˜¤ê¸°();
            
            // 2ë‹¨ê³„: ì „ì²´ UI ì—…ë°ì´íŠ¸
            ì „ì²´ì—…ë°ì´íŠ¸();
            
            ë¡œê·¸('âœ… ìˆ˜ì…/ì§€ì¶œ ê´€ë¦¬ ì‹œìŠ¤í…œì´ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
            ë¡œê·¸('ğŸ’¡ "ë°ì´í„° ê´€ë¦¬" íƒ­ì—ì„œ ìƒ˜í”Œ ë°ì´í„°ë¥¼ ë¡œë“œí•˜ê±°ë‚˜ ì´ì „ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            ë¡œê·¸(`ğŸ’° í˜„ì¬ ì›” íˆ¬ìì—¬ë ¥: ${ìˆ«ìí¬ë§·(íˆ¬ìì—¬ë ¥ê³„ì‚°())}ë§Œì›`);
            ë¡œê·¸(`ğŸ“… ë“±ë¡ëœ ì›”ìˆ˜: ${Object.keys(ì›”ë³„ë°ì´í„°).length}ê°œì›”`);
            
            // 3ë‹¨ê³„: ë¶€ëª¨ ì°½ì— ë¡œë“œ ì™„ë£Œ ì•Œë¦¼ (ì—¬ëŸ¬ ë°©ì‹ìœ¼ë¡œ ì „ì†¡)
            if (window.parent !== window) {
                ë¡œê·¸('ğŸ“¡ ë¶€ëª¨ ì°½ì— ë¡œë“œ ì™„ë£Œ ì•Œë¦¼ ì „ì†¡ ì‹œì‘');
                
                // ê¸°ë³¸ ë¡œë“œ ì™„ë£Œ ë©”ì‹œì§€
                window.parent.postMessage({
                    type: 'MODULE2_LOADED',
                    data: {
                        íˆ¬ìì—¬ë ¥: íˆ¬ìì—¬ë ¥ê³„ì‚°(),
                        ë“±ë¡ì›”ìˆ˜: Object.keys(ì›”ë³„ë°ì´í„°).length,
                        ë§ˆì§€ë§‰ì—…ë°ì´íŠ¸: new Date().toLocaleString()
                    }
                }, '*');
                
                // â­ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì¦‰ì‹œ ì „ì†¡
                if (ë°ì´í„°ë¡œë“œì„±ê³µ) {
                    const í˜„ì¬ì›”í‚¤ê°’ = í˜„ì¬ì›”í‚¤();
                    const ì™„ì „í•œë°ì´í„° = {
                        ì›”ë³„ë°ì´í„°: ì›”ë³„ë°ì´í„°,
                        ì›”ìˆ˜ì…: ì›”ì´ìˆ˜ì…ê³„ì‚°(),
                        ì›”ì§€ì¶œ: ì›”ì´ì§€ì¶œê³„ì‚°(),
                        íˆ¬ìì—¬ë ¥: íˆ¬ìì—¬ë ¥ê³„ì‚°(),
                        ìˆ˜ì…ê±´ìˆ˜: ì›”ë³„ë°ì´í„°[í˜„ì¬ì›”í‚¤ê°’] ? ì›”ë³„ë°ì´í„°[í˜„ì¬ì›”í‚¤ê°’].ìˆ˜ì….length : 0,
                        ì§€ì¶œê±´ìˆ˜: ì›”ë³„ë°ì´í„°[í˜„ì¬ì›”í‚¤ê°’] ? ì›”ë³„ë°ì´í„°[í˜„ì¬ì›”í‚¤ê°’].ì§€ì¶œ.length : 0,
                        í˜„ì¬ë…„ì›”: { year: í˜„ì¬ë…„ì›”.getFullYear(), month: í˜„ì¬ë…„ì›”.getMonth() },
                        ë§ˆì§€ë§‰ì—…ë°ì´íŠ¸: new Date().toISOString()
                    };
                    
                    // ì—¬ëŸ¬ íƒ€ì…ì˜ ë©”ì‹œì§€ë¡œ ì „ì†¡
                    window.parent.postMessage({
                        type: 'MODULE2_DATA',
                        data: ì™„ì „í•œë°ì´í„°
                    }, '*');
                    
                    window.parent.postMessage({
                        type: 'MODULE2_DATA_UPDATE',
                        data: ì™„ì „í•œë°ì´í„°
                    }, '*');
                    
                    ë¡œê·¸('ğŸ“¡ ì´ˆê¸° ë°ì´í„° ì „ì†¡ ì™„ë£Œ', ì™„ì „í•œë°ì´í„°);
                }
                
                ë¡œê·¸('ğŸ“¡ ë¶€ëª¨ ì°½ì— ë¡œë“œ ì™„ë£Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ');
            }
            
            // â­ 4ë‹¨ê³„: ì¶”ê°€ í™•ì¸ì„ ìœ„í•œ ì§€ì—°ëœ ë°ì´í„° ì „ì†¡
            setTimeout(() => {
                if (window.parent !== window && ë°ì´í„°ë¡œë“œì„±ê³µ) {
                    ë¡œê·¸('ğŸ“¡ ì§€ì—°ëœ ë°ì´í„° ì¬ì „ì†¡ ì‹¤í–‰');
                    ìë™ì €ì¥(); // ë‹¤ì‹œ í•œë²ˆ ë°ì´í„° ì „ì†¡
                }
            }, 2000);
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', ì‹œìŠ¤í…œì´ˆê¸°í™”);
        
        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ìµœì¢… ìë™ ì €ì¥
        window.addEventListener('beforeunload', function() {
            ìë™ì €ì¥();
        });
        
        // â­ ê°•í™”ëœ PostMessage ìˆ˜ì‹  ì²˜ë¦¬ (index.htmlê³¼ì˜ í†µì‹ )
        window.addEventListener('message', function(event) {
            ë¡œê·¸('ğŸ“¬ PostMessage ìˆ˜ì‹ ', event.data);
            
            if (event.data && event.data.type === 'REQUEST_DATA') {
                ë¡œê·¸('ğŸ“Š ë¶€ëª¨ ì°½ì—ì„œ ë°ì´í„° ìš”ì²­ ìˆ˜ì‹ ');
                
                // ë¶€ëª¨ ì°½ì—ì„œ ë°ì´í„° ìš”ì²­ì´ ì˜¤ë©´ í˜„ì¬ ë°ì´í„° ì „ì†¡
                const í˜„ì¬ì›”í‚¤ê°’ = í˜„ì¬ì›”í‚¤();
                const í˜„ì¬ë°ì´í„° = {
                    ì›”ë³„ë°ì´í„°: ì›”ë³„ë°ì´í„°,
                    íˆ¬ìì—¬ë ¥: íˆ¬ìì—¬ë ¥ê³„ì‚°(),
                    ì›”ìˆ˜ì…: ì›”ì´ìˆ˜ì…ê³„ì‚°(),
                    ì›”ì§€ì¶œ: ì›”ì´ì§€ì¶œê³„ì‚°(),
                    ìˆ˜ì…ê±´ìˆ˜: ì›”ë³„ë°ì´í„°[í˜„ì¬ì›”í‚¤ê°’] ? ì›”ë³„ë°ì´í„°[í˜„ì¬ì›”í‚¤ê°’].ìˆ˜ì….length : 0,
                    ì§€ì¶œê±´ìˆ˜: ì›”ë³„ë°ì´í„°[í˜„ì¬ì›”í‚¤ê°’] ? ì›”ë³„ë°ì´í„°[í˜„ì¬ì›”í‚¤ê°’].ì§€ì¶œ.length : 0,
                    ë“±ë¡ì›”ìˆ˜: Object.keys(ì›”ë³„ë°ì´í„°).length,
                    í˜„ì¬ë…„ì›”: { year: í˜„ì¬ë…„ì›”.getFullYear(), month: í˜„ì¬ë…„ì›”.getMonth() },
                    ë§ˆì§€ë§‰ì—…ë°ì´íŠ¸: new Date().toISOString()
                };
                
                event.source.postMessage({
                    type: 'MODULE2_DATA',
                    data: í˜„ì¬ë°ì´í„°
                }, '*');
                
                ë¡œê·¸('ğŸ“¡ ë°ì´í„° ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µ ì „ì†¡ ì™„ë£Œ', í˜„ì¬ë°ì´í„°);
            }
            
            // ëŒ€ì‹œë³´ë“œì—ì„œ ìë™ë¶ˆëŸ¬ì˜¤ê¸° ìš”ì²­
            if (event.data && event.data.type === 'LOAD_DATA') {
                ë¡œê·¸('ğŸ“‚ ëŒ€ì‹œë³´ë“œì—ì„œ ìë™ë¶ˆëŸ¬ì˜¤ê¸° ìš”ì²­');
                ìë™ë¶ˆëŸ¬ì˜¤ê¸°();
                ì „ì²´ì—…ë°ì´íŠ¸();
                // ë¶ˆëŸ¬ì˜¤ê¸° í›„ ì¦‰ì‹œ ë°ì´í„° ì „ì†¡
                setTimeout(() => ìë™ì €ì¥(), 100);
            }
            
            // ìƒˆë¡œê³ ì¹¨ ìš”ì²­ ì²˜ë¦¬
            if (event.data && event.data.type === 'REFRESH_REQUEST') {
                ë¡œê·¸('ğŸ”„ ëŒ€ì‹œë³´ë“œì—ì„œ ìƒˆë¡œê³ ì¹¨ ìš”ì²­');
                ìë™ë¶ˆëŸ¬ì˜¤ê¸°();
                ì „ì²´ì—…ë°ì´íŠ¸();
                // ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ ì•Œë¦¼
                window.parent.postMessage({
                    type: 'REFRESH_COMPLETED',
                    module: 'module2'
                }, '*');
            }
        });
        
        // â­ ì¶”ê°€: í˜ì´ì§€ ê°€ì‹œì„± ë³€ê²½ ì‹œ ë°ì´í„° ì „ì†¡
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden && window.parent !== window) {
                ë¡œê·¸('ğŸ‘ï¸ í˜ì´ì§€ ë‹¤ì‹œ ë³´ì„ - ë°ì´í„° ì¬ì „ì†¡');
                window.parent.postMessage({
                    type: 'MODULE_VISIBLE',
                    module: 'module2'
                }, '*');
                setTimeout(() => ìë™ì €ì¥(), 300);
            }
        });
        
        // â­ ì¶”ê°€: ì •ê¸°ì  í•˜íŠ¸ë¹„íŠ¸ (ì—°ê²° ìƒíƒœ í™•ì¸)
        setInterval(() => {
            if (window.parent !== window) {
                window.parent.postMessage({
                    type: 'HEARTBEAT',
                    module: 'module2',
                    timestamp: new Date().getTime()
                }, '*');
            }
        }, 10000); // 10ì´ˆë§ˆë‹¤
    </script>
</body>
</html>